<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PathPilot Labs</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body { font-family: 'Segoe UI', sans-serif; padding: 2em; }
  .roadmap-card { margin-bottom: 1em; }
  pre { background: #f8f9fa; padding: 1em; overflow-x: auto; }
  .delete-btn { float: right; }
</style>
</head>
<body>
<div class="container">
  <h1 class="mb-4">ðŸš€ PathPilot Labs - Career Roadmaps</h1>
  <button class="btn btn-primary mb-4" onclick="createRoadmap()">+ New Roadmap</button>
  <div id="roadmaps"></div>
</div>

<script>
const API_BASE = 'http://127.0.0.1:5000';

async function loadRoadmaps() {
  try {
    const res = await fetch(`${API_BASE}/roadmaps`);
    const data = await res.json();
    
    // âœ… Force refresh + debug
    console.log('Loaded roadmaps:', data);
    
    const container = document.getElementById('roadmaps');
    if (!data || data.length === 0) {
      container.innerHTML = '<p class="text-muted">No roadmaps yet. Create one!</p>';
      return;
    }
    
    container.innerHTML = data.map(r => `
      <div class="card roadmap-card">
        <div class="card-body">
          <h5>${r.name} 
            <button class="btn btn-sm btn-danger delete-btn" onclick="deleteRoadmap(${r.id})">Ã—</button>
          </h5>
          <div class="progress mb-2">
            <div class="progress-bar bg-success" style="width: ${r.progress_pct || 0}%">
              ${r.progress_pct || 0}%
            </div>
          </div>
          <small>ID: ${r.id} | Created: ${r.created}</small><br>
          <strong>Tasks (${r.tasks?.length || 0}):</strong>
          <pre>${JSON.stringify(r.tasks || [], null, 2)}</pre>
        </div>
      </div>
    `).join('');
  } catch (err) {
    console.error('Load error:', err);
    document.getElementById('roadmaps').innerHTML = `<div class="alert alert-danger">Error: ${err.message}</div>`;
  }
}


async function createRoadmap() {
  const name = prompt('Roadmap name (e.g. "Frontend React", "ML Basics")?') || 'New Roadmap';
  
  try {
    const res = await fetch(`${API_BASE}/roadmaps`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name })  // Frontend sends name â†’ backend generates plan
    });
    const newRoadmap = await res.json();
    console.log('Dynamic roadmap:', newRoadmap.plan);
    await loadRoadmaps();
    alert(`âœ… "${name}" dynamic roadmap generated!`);
  } catch (err) {
    console.error(err);
  }
}


async function deleteRoadmap(id) {
  if (!confirm('Delete this roadmap?')) return;
  try {
    await fetch(`${API_BASE}/roadmaps/${id}`, { method: 'DELETE' });
    await loadRoadmaps();
  } catch (err) {
    console.error(err);
  }
}

// Auto-load on start
loadRoadmaps();
</script>
</body>
</html>
